{% extends "recipes/base.html" %}

{% block title %}Dashboard - Souschef.ai{% endblock %}

{% block content %}

<div class="card" style="border-top-color: #d4853b; text-align: center; padding: 1.5rem 2rem;">
    <h2 style="margin-bottom: 0.3rem;">Souschef.ai</h2>
    <p style="font-style: italic; color: #8a7e72; margin-bottom: 0.8rem;">Where culinary passion meets code</p>
    <p style="font-size: 0.95rem; max-width: 640px; margin: 0 auto 0.6rem;">
        Created by <strong>Melanie Mann</strong>, a Le Cordon Bleu (Orlando, FL) trained chef with 25 years of experience across the culinary industry. Melanie went back to school to build an easy, user-friendly software designed for home use and start-up companies.
    </p>
    <p class="meta">Established February 9, 2026</p>
</div>

{% if urgent_items %}
<div class="alert-banner {% if urgent_items.0.status == 'expired' or urgent_items.0.status == 'today' %}alert-banner-danger{% else %}alert-banner-warning{% endif %}">
    <strong>Pantry Alert:</strong> You have items expiring soon!
    <ul>
        {% for item in urgent_items %}
        <li>
            <strong>{{ item.name }}</strong>{% if item.quantity %} ({{ item.quantity }}){% endif %}
            &mdash; <span class="status-badge status-{{ item.status }}">{{ item.status_label }}</span>
        </li>
        {% endfor %}
    </ul>
    <p style="margin-top: 0.5rem;"><a href="{% url 'pantry_list' %}">View pantry &rarr;</a></p>
</div>
{% endif %}

{% if low_stock_items %}
<div class="alert-banner alert-banner-warning">
    <strong>Low Stock Alert:</strong> These pantry items are running low!
    <ul>
        {% for item in low_stock_items %}
        <li>
            <strong>{{ item.name }}</strong>
            {% if item.quantity_amount is not None %} ({{ item.quantity_amount }} {{ item.unit }}){% endif %}
            &mdash; <span class="status-badge status-lowstock">Low Stock</span>
        </li>
        {% endfor %}
    </ul>
    <p style="margin-top: 0.5rem;"><a href="{% url 'pantry_list' %}">View pantry &rarr;</a></p>
</div>
{% endif %}

<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1rem;">
    <div class="card" style="text-align: center;">
        <p style="font-size: 2rem; font-weight: 800; color: #c26a3a; margin-bottom: 0.2rem;">{{ recipe_count }}</p>
        <p style="font-weight: 600; margin-bottom: 0.5rem;">Recipe{{ recipe_count|pluralize }}</p>
        <a href="{% url 'recipe_create' %}" class="btn btn-primary btn-sm">+ Add Recipe</a>
    </div>
    <div class="card" style="text-align: center;">
        <p style="font-size: 2rem; font-weight: 800; color: #6b8f4e; margin-bottom: 0.2rem;">{{ pantry_count }}</p>
        <p style="font-weight: 600; margin-bottom: 0.5rem;">Pantry Item{{ pantry_count|pluralize }}</p>
        <a href="{% url 'pantry_add' %}" class="btn btn-success btn-sm">+ Add Item</a>
    </div>
    <div class="card" style="text-align: center;">
        <p style="font-size: 2rem; font-weight: 800; color: #d4853b; margin-bottom: 0.2rem;">{{ shopping_count }}</p>
        <p style="font-weight: 600; margin-bottom: 0.5rem;">Shopping Item{{ shopping_count|pluralize }}</p>
        <a href="{% url 'shopping_add' %}" class="btn btn-primary btn-sm">+ Add Item</a>
    </div>
</div>

<div class="card">
    <div class="page-header">
        <h2>Recently Added Recipes</h2>
        <a href="{% url 'recipe_list' %}" class="btn btn-secondary btn-sm">View All &rarr;</a>
    </div>
    {% for recipe in recent_recipes %}
    <div style="display: flex; gap: 0.8rem; align-items: center; padding: 0.5rem 0; {% if not forloop.last %}border-bottom: 1px solid #eee;{% endif %}">
        {% if recipe.image %}
        <img src="{{ recipe.image.url }}" alt="{{ recipe.title }}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 6px;">
        {% else %}
        <div style="width: 50px; height: 50px; background: #f0e6d3; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 1.3rem; color: #c4a882; flex-shrink: 0;">&#127860;</div>
        {% endif %}
        <div style="flex: 1;">
            <a href="{% url 'recipe_detail' recipe.slug %}" style="font-weight: 600; text-decoration: none;">{{ recipe.title }}</a>
            <p class="meta" style="margin-bottom: 0;">
                {% if recipe.category %}<span class="badge">{{ recipe.category.name }}</span>{% endif %}
                {{ recipe.prep_time }}+{{ recipe.cook_time }} min
            </p>
        </div>
    </div>
    {% empty %}
    <p>No recipes yet. <a href="{% url 'recipe_create' %}">Add your first recipe!</a></p>
    {% endfor %}
</div>

{% if urgent_items or low_stock_items %}
<div class="card">
    <h2>Pantry Summary</h2>
    <p style="margin-bottom: 0.5rem;">
        {% if urgent_items %}
            <span class="status-badge status-warning">{{ urgent_items|length }} expiring soon</span>
        {% endif %}
        {% if low_stock_items %}
            <span class="status-badge status-lowstock">{{ low_stock_items|length }} low stock</span>
        {% endif %}
    </p>
    <a href="{% url 'pantry_list' %}">View full pantry &rarr;</a>
</div>
{% endif %}

{% if unchecked_shopping %}
<div class="card">
    <div class="page-header">
        <h2>Shopping List</h2>
        <a href="{% url 'shopping_list' %}" class="btn btn-secondary btn-sm">View All &rarr;</a>
    </div>
    <ul style="list-style: none; padding: 0;">
        {% for item in unchecked_shopping %}
        <li style="padding: 0.3rem 0; {% if not forloop.last %}border-bottom: 1px solid #eee;{% endif %}">
            <strong>{{ item.name }}</strong>
            {% if item.quantity %}<span class="meta"> &mdash; {{ item.quantity }}</span>{% endif %}
            <span class="badge">{{ item.get_section_display }}</span>
        </li>
        {% endfor %}
    </ul>
</div>
{% endif %}

{% if categories %}
<div class="card">
    <div class="page-header">
        <h2>Categories</h2>
        <a href="{% url 'category_list' %}" class="btn btn-secondary btn-sm">View All &rarr;</a>
    </div>
    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem;">
        {% for cat in categories %}
        <a href="{% url 'category_detail' cat.slug %}" class="badge" style="text-decoration: none;">
            {{ cat.name }} ({{ cat.recipe_count }})
        </a>
        {% endfor %}
    </div>
</div>
{% endif %}

{% endblock %}
